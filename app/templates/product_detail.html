{% extends 'base.html' %}
{% block content %}
<h2>{{ product.name }}</h2>
<img src="{{ product.image_url }}" alt="{{ product.name }}" style="width:200px;">

<p>Цена: {{ product.price }} руб.</p>
<p>Категория: {{ product.category }} | Цвет: {{ product.color }} | Материал: {{ product.material }}</p>
<p>Рейтинг: {{ avg_rating|round(1) }} / 5</p>

<h3>Отзывы:</h3>
{% if reviews %}
    <ul>
    {% for review in reviews %}
        <li>
            Рейтинг: {{ review.rating }} — {{ review.comment }}<br>
            Автор: {{ review.user.username }} | Дата: {{ review.created_at }}
        </li>
    {% endfor %}
    </ul>
{% else %}
    <p>Отзывов ещё нет. Будьте первым!</p>
{% endif %}

{% if current_user.is_authenticated %}
<h4>Оставить отзыв</h4>
<form method="POST" action="{{ url_for('main_bp.add_review', product_id=product.id) }}">
    Рейтинг (1-5): <input type="number" name="rating" min="1" max="5" value="5"><br>
    Комментарий: <br>
    <textarea name="comment" rows="4" cols="50"></textarea><br>
    <button type="submit">Отправить</button>
</form>
<form method="POST" action="{{ url_for('main_bp.add_favorite', product_id=product.id) }}">
  <button type="submit">Добавить в избранное</button>
</form>
{% else %}
<p>Чтобы оставить отзыв, <a href="{{ url_for('main_bp.login') }}">войдите в систему</a>.</p>
{% endif %}
{% endblock %}
